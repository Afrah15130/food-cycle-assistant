<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreshScan - AI Food Analysis System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 50%, #2dd4bf 100%);
            min-height: 100vh;
            padding: 0;
        }

        .page {
            display: none;
            min-height: 100vh;
        }

        .page.active {
            display: flex;
        }

        /* Login Page */
        .login-page {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .login-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            overflow: hidden;
            max-width: 1100px;
            width: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            min-height: 600px;
        }

        .login-left {
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
            color: white;
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .login-left h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            font-weight: 700;
            line-height: 1.2;
        }

        .login-left .subtitle {
            font-size: 1.15em;
            opacity: 0.95;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .feature-list {
            list-style: none;
            margin-top: 20px;
        }

        .feature-list li {
            padding: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.05em;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .feature-list li:last-child {
            border-bottom: none;
        }

        .feature-list li::before {
            content: "‚úì";
            background: rgba(255,255,255,0.25);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .login-right {
            padding: 60px 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .login-header {
            margin-bottom: 35px;
        }

        .login-header h2 {
            color: #0f766e;
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .login-header p {
            color: #64748b;
            font-size: 1em;
        }

        .form-group {
            margin-bottom: 22px;
        }

        .form-group label {
            display: block;
            color: #334155;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 0.95em;
        }

        .form-group input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
            background: #f8fafc;
        }

        .form-group input:focus {
            outline: none;
            border-color: #14b8a6;
            background: white;
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 10px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(20, 184, 166, 0.4);
        }

        .btn-secondary {
            background: #64748b;
            box-shadow: 0 4px 12px rgba(100, 116, 139, 0.3);
        }

        .auth-footer {
            text-align: center;
            margin-top: 25px;
            color: #64748b;
            font-size: 0.95em;
        }

        .auth-footer a {
            color: #0f766e;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        /* Register Page */
        .register-container {
            max-width: 550px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            padding: 50px;
        }

        /* Main App */
        .main-app {
            width: 100%;
            background: #f1f5f9;
        }

        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .navbar-brand .logo {
            font-size: 1.8em;
        }

        .navbar-brand .brand-text h1 {
            font-size: 1.5em;
            font-weight: 700;
            color: #0f766e;
            line-height: 1.2;
        }

        .navbar-brand .brand-text p {
            font-size: 0.8em;
            color: #64748b;
            margin-top: 2px;
        }

        .navbar-right {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: #f0fdfa;
            border-radius: 25px;
            color: #0f766e;
            font-weight: 600;
        }

        .btn-small {
            padding: 10px 24px;
            font-size: 0.95em;
            width: auto;
        }

        .mode-toggle {
            display: flex;
            gap: 10px;
            background: #f0fdfa;
            padding: 5px;
            border-radius: 25px;
        }

        .mode-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: #0f766e;
            font-weight: 600;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(20, 184, 166, 0.3);
        }

        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
        }

        .content-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .content-header h1 {
            color: #0f172a;
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .content-header p {
            color: #64748b;
            font-size: 1.2em;
        }

        .mode-section {
            display: none;
        }

        .mode-section.active {
            display: block;
        }

        /* Daily Quote */
        .daily-quote {
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
            text-align: center;
        }

        .daily-quote h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .daily-quote p {
            font-size: 1.2em;
            font-style: italic;
            line-height: 1.6;
        }

        /* Stats Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            text-align: center;
        }

        .stat-card .icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: 700;
            color: #0f766e;
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: #64748b;
            font-size: 0.95em;
        }

        /* Food Grid */
        .food-selector {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .food-selector h2 {
            color: #0f172a;
            font-size: 1.8em;
            margin-bottom: 25px;
            text-align: center;
        }

        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .food-item {
            background: #f8fafc;
            border: 3px solid #e2e8f0;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .food-item:hover {
            transform: translateY(-5px);
            border-color: #14b8a6;
            box-shadow: 0 8px 20px rgba(20, 184, 166, 0.2);
        }

        .food-item.selected {
            border-color: #0f766e;
            background: #ccfbf1;
        }

        .food-item .emoji {
            font-size: 2.5em;
            margin-bottom: 8px;
        }

        .food-item .name {
            font-weight: 600;
            color: #0f172a;
            font-size: 0.95em;
        }

        .food-item .type {
            font-size: 0.75em;
            color: #64748b;
            margin-top: 3px;
        }

        /* Upload Section */
        .upload-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .upload-card {
            border: 3px dashed #cbd5e1;
            border-radius: 15px;
            padding: 50px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            background: #f8fafc;
        }

        .upload-card:hover {
            border-color: #14b8a6;
            background: #f0fdfa;
            transform: translateY(-2px);
        }

        .upload-card.dragover {
            border-color: #0f766e;
            background: #ccfbf1;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .upload-card h2 {
            color: #0f172a;
            margin-bottom: 12px;
            font-size: 1.6em;
            font-weight: 700;
        }

        .upload-card p {
            color: #64748b;
            margin-bottom: 25px;
            font-size: 1em;
        }

        .upload-btn {
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
            color: white;
            border: none;
            padding: 14px 35px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.3);
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(20, 184, 166, 0.4);
        }

        #fileInput {
            display: none;
        }

        .preview-section {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 40px;
        }

        .preview-section.active {
            display: block;
        }

        .preview-image {
            width: 100%;
            max-width: 600px;
            border-radius: 15px;
            margin: 0 auto 30px;
            display: block;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Processing Steps */
        .processing-steps {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 40px;
            display: none;
        }

        .processing-steps.active {
            display: block;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 18px;
            margin-bottom: 12px;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid #e2e8f0;
            transition: all 0.5s;
        }

        .step.processing {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }

        .step.completed {
            border-left-color: #10b981;
            background: #d1fae5;
        }

        .step-icon {
            font-size: 1.8em;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .step-content h4 {
            color: #0f172a;
            margin-bottom: 4px;
            font-size: 1em;
        }

        .step-content p {
            color: #64748b;
            font-size: 0.9em;
        }

        .step-loader {
            width: 22px;
            height: 22px;
            border: 3px solid #f3f4f6;
            border-top: 3px solid #14b8a6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none;
        }

        .step.processing .step-loader {
            display: block;
        }

        /* Results */
        .results-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            animation: slideUp 0.5s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.12);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-card h3 {
            color: #0f172a;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3em;
            font-weight: 700;
        }

        .result-card .icon {
            font-size: 1.5em;
        }

        .confidence-score {
            background: #f0fdfa;
            padding: 12px;
            border-radius: 10px;
            margin: 12px 0;
            border-left: 4px solid #14b8a6;
        }

        .confidence-score strong {
            color: #0f766e;
            font-size: 1em;
        }

        .freshness-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 12px 0;
        }

        .freshness-bar {
            flex: 1;
            height: 22px;
            background: #e2e8f0;
            border-radius: 11px;
            overflow: hidden;
        }

        .freshness-fill {
            height: 100%;
            transition: width 1.5s ease;
            border-radius: 11px;
        }

        .fresh { background: linear-gradient(90deg, #10b981 0%, #34d399 100%); }
        .moderate { background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 100%); }
        .poor { background: linear-gradient(90deg, #ef4444 0%, #f87171 100%); }

        .nutrition-table {
            width: 100%;
            margin-top: 15px;
        }

        .nutrition-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.95em;
        }

        .nutrition-row:last-child {
            border-bottom: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 50px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .spinner {
            border: 5px solid #f1f5f9;
            border-top: 5px solid #14b8a6;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tag {
            display: inline-block;
            padding: 5px 14px;
            border-radius: 18px;
            font-size: 0.85em;
            margin: 4px 4px 4px 0;
            font-weight: 600;
        }

        .tag-primary { background: #ccfbf1; color: #0f766e; }
        .tag-success { background: #d1fae5; color: #065f46; }
        .tag-warning { background: #fef3c7; color: #92400e; }
        .tag-danger { background: #fee2e2; color: #991b1b; }

        .llm-badge {
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
            color: white;
            padding: 7px 14px;
            border-radius: 18px;
            font-size: 0.8em;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 7px;
            margin-top: 8px;
        }

        /* History Section */
        .history-section {
            background: white;
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .history-section h2 {
            color: #0f172a;
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .history-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 18px;
            background: #f8fafc;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .history-item:hover {
            background: #f0fdfa;
            transform: translateX(5px);
        }

        .history-item .emoji {
            font-size: 2.5em;
        }

        .history-item .details {
            flex: 1;
        }

        .history-item .details h4 {
            color: #0f172a;
            margin-bottom: 5px;
        }

        .history-item .details p {
            color: #64748b;
            font-size: 0.9em;
        }

        .history-item .score {
            font-size: 1.5em;
            font-weight: 700;
        }

        .history-item .score.healthy {
            color: #10b981;
        }

        .history-item .score.unhealthy {
            color: #ef4444;
        }

        /* Diet Plans */
        .diet-plans {
            background: white;
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .diet-plans h2 {
            color: #0f172a;
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .diet-plan-card {
            background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #14b8a6;
        }

        .diet-plan-card h3 {
            color: #0f766e;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .diet-plan-card ul {
            list-style: none;
            padding-left: 0;
        }

        .diet-plan-card li {
            padding: 10px 0;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .diet-plan-card li::before {
            content: "‚úì";
            background: #14b8a6;
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
            flex-shrink: 0;
        }

        /* Charts */
        .chart-container {
            background: white;
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .chart-container h2 {
            color: #0f172a;
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .ai-notice {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .ai-notice h4 {
            color: #92400e;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .ai-notice p {
            color: #78350f;
            line-height: 1.6;
            font-size: 0.95em;
        }

        @media (max-width: 968px) {
            .login-container {
                grid-template-columns: 1fr;
            }
            
            .login-left {
                display: none;
            }

            .navbar {
                padding: 15px 20px;
            }

            .main-content {
                padding: 20px;
            }

            .food-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }

            .results-section {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="page active">
        <div class="login-page">
            <div class="login-container">
                <div class="login-left">
                    <h1>üîç FreshScan</h1>
                    <p class="subtitle">Advanced AI-powered food analysis with intelligent image recognition, health tracking, and personalized nutrition insights.</p>
                    
                    <ul class="feature-list">
                        <li>Smart AI Image Analysis</li>
                        <li>Analysis History & Graphs</li>
                        <li>Daily Health Quotes</li>
                        <li>Personalized Diet Plans</li>
                        <li>Nutritional Tracking</li>
                    </ul>
                </div>
                <div class="login-right">
                    <div class="login-header">
                        <h2>Welcome Back</h2>
                        <p>Sign in to your account</p>
                    </div>
                    <form onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" id="loginEmail" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" placeholder="Enter your password" required>
                        </div>
                        <button type="submit" class="btn">Sign In</button>
                    </form>
                    <div class="auth-footer">
                        Don't have an account? <a onclick="showPage('register')">Sign Up</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Page -->
    <div id="registerPage" class="page">
        <div class="login-page">
            <div class="register-container">
                <div class="login-header">
                    <h2>Create Account</h2>
                    <p>Join FreshScan today</p>
                </div>
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="regName" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="regEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="regPassword" placeholder="Create a password (min 6 characters)" required>
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="regConfirmPassword" placeholder="Confirm your password" required>
                    </div>
                    <button type="submit" class="btn">Create Account</button>
                </form>
                <div class="auth-footer">
                    Already have an account? <a onclick="showPage('login')">Sign In</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="page">
        <div class="main-app">
            <nav class="navbar">
                <div class="navbar-brand">
                    <span class="logo">üîç</span>
                    <div class="brand-text">
                        <h1>FreshScan</h1>
                        <p>AI Powered Analysis</p>
                    </div>
                </div>
                <div class="navbar-right">
                    <div class="mode-toggle">
                        <button class="mode-btn active" onclick="switchMode('dashboard')">Dashboard</button>
                        <button class="mode-btn" onclick="switchMode('quick')">Quick Scan</button>
                        <button class="mode-btn" onclick="switchMode('advanced')">AI Upload</button>
                        <button class="mode-btn" onclick="switchMode('history')">History</button>
                        <button class="mode-btn" onclick="switchMode('diet')">Diet Plans</button>
                    </div>
                    <div class="user-badge">
                        <span>üë§</span>
                        <span id="userName">User</span>
                    </div>
                    <button class="btn btn-small btn-secondary" onclick="handleLogout()">Logout</button>
                </div>
            </nav>

            <div class="main-content">
                <!-- Dashboard Mode -->
                <div id="dashboardMode" class="mode-section active">
                    <div class="content-header">
                        <h1>Health Dashboard</h1>
                        <p>Track your nutrition and wellness journey</p>
                    </div>

                    <!-- Daily Quote -->
                    <div class="daily-quote">
                        <h3>üí° Daily Health Quote</h3>
                        <p id="dailyQuote"></p>
                    </div>

                    <!-- Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="icon">üìä</div>
                            <div class="value" id="totalScans">0</div>
                            <div class="label">Total Scans</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon">üåø</div>
                            <div class="value" id="healthyCount">0</div>
                            <div class="label">Healthy Foods</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon">‚ö†Ô∏è</div>
                            <div class="value" id="junkCount">0</div>
                            <div class="label">Junk Foods</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon">üìà</div>
                            <div class="value" id="avgScore">0%</div>
                            <div class="label">Avg Health Score</div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="chart-container">
                        <h2>üìà Weekly Analysis Trend</h2>
                        <canvas id="weeklyChart"></canvas>
                    </div>

                    <div class="chart-container">
                        <h2>ü•ß Food Category Distribution</h2>
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <!-- Quick Scan Mode -->
                <div id="quickMode" class="mode-section">
                    <div class="content-header">
                        <h1>Quick Food Scan</h1>
                        <p>Select a food item for instant analysis</p>
                    </div>

                    <div class="food-selector">
                        <h2>Choose Food Item</h2>
                        <div class="food-grid" id="foodGrid"></div>
                    </div>
                </div>

                <!-- Advanced AI Upload Mode -->
                <div id="advancedMode" class="mode-section">
                    <div class="content-header">
                        <h1>AI Vision Analysis</h1>
                        <p>Upload your food image for intelligent analysis</p>
                    </div>

                    <div class="ai-notice">
                        <h4>ü§ñ Advanced AI Image Recognition</h4>
                        <p>Our system uses intelligent color and pattern detection to identify your food. For best results, ensure good lighting and clear images. The AI analyzes visual characteristics like color, texture, and shape to determine the food type and provide accurate nutritional information.</p>
                    </div>

                    <div class="upload-section">
                        <div class="llm-badge" style="display: flex; justify-content: center; margin-bottom: 25px;">
                            <span>ü§ñ Powered by Smart AI Vision</span>
                        </div>
                        
                        <div class="upload-card" id="uploadCard" onclick="document.getElementById('fileInput').click()">
                            <div class="upload-icon">üì∏</div>
                            <h2>Upload Your Food Picture</h2>
                            <p>AI will analyze your food image intelligently</p>
                            <input type="file" id="fileInput" accept="image/*">
                            <button class="upload-btn" type="button">
                                üìÅ Browse Files
                            </button>
                        </div>
                    </div>

                    <div class="preview-section" id="previewSection">
                        <h3 style="text-align: center; color: #0f172a; margin-bottom: 20px;">Image Preview</h3>
                        <img id="previewImage" class="preview-image" alt="Food preview">
                        <div class="action-buttons">
                            <button class="btn" onclick="analyzeUploadedImage()">ü§ñ Run AI Analysis</button>
                            <button class="btn btn-secondary" onclick="resetUpload()">üîÑ Upload New Image</button>
                        </div>
                    </div>

                    <div class="processing-steps" id="processingSteps">
                        <h3 style="color: #0f172a; margin-bottom: 20px; text-align: center;">AI Processing Pipeline</h3>
                        
                        <div class="step" id="step1">
                            <div class="step-icon">üì•</div>
                            <div class="step-content">
                                <h4>Image Preprocessing</h4>
                                <p>Optimizing for AI analysis</p>
                            </div>
                            <div class="step-loader"></div>
                        </div>

                        <div class="step" id="step2">
                            <div class="step-icon">üé®</div>
                            <div class="step-content">
                                <h4>Color Analysis</h4>
                                <p>Detecting dominant colors</p>
                            </div>
                            <div class="step-loader"></div>
                        </div>

                        <div class="step" id="step3">
                            <div class="step-icon">üîç</div>
                            <div class="step-content">
                                <h4>Pattern Recognition</h4>
                                <p>Identifying food characteristics</p>
                            </div>
                            <div class="step-loader"></div>
                        </div>

                        <div class="step" id="step4">
                            <div class="step-icon">üìä</div>
                            <div class="step-content">
                                <h4>Nutritional Analysis</h4>
                                <p>Generating insights</p>
                            </div>
                            <div class="step-loader"></div>
                        </div>

                        <div class="step" id="step5">
                            <div class="step-icon">‚úÖ</div>
                            <div class="step-content">
                                <h4>Analysis Complete</h4>
                                <p>Preparing results</p>
                            </div>
                            <div class="step-loader"></div>
                        </div>
                    </div>
                </div>

                <!-- History Mode -->
                <div id="historyMode" class="mode-section">
                    <div class="content-header">
                        <h1>Analysis History</h1>
                        <p>View your past food scans</p>
                    </div>

                    <div class="history-section">
                        <h2>üìú Recent Scans</h2>
                        <div id="historyList"></div>
                    </div>
                </div>

                <!-- Diet Plans Mode -->
                <div id="dietMode" class="mode-section">
                    <div class="content-header">
                        <h1>Personalized Diet Plans</h1>
                        <p>Achieve your health goals with expert nutrition plans</p>
                    </div>

                    <div class="diet-plans" id="dietPlans"></div>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <h3 style="color: #0f766e; margin-bottom: 10px;">Running AI Analysis...</h3>
                    <p style="color: #64748b;">Processing your food image</p>
                </div>

                <div id="results"></div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentMode = 'dashboard';
        let uploadedImage = null;
        let analysisHistory = [];
        let weeklyChart = null;
        let categoryChart = null;

        // Health Quotes
        const healthQuotes = [
            "Let food be thy medicine and medicine be thy food. - Hippocrates",
            "Take care of your body. It's the only place you have to live. - Jim Rohn",
            "The food you eat can be either the safest and most powerful form of medicine or the slowest form of poison. - Ann Wigmore",
            "Your diet is a bank account. Good food choices are good investments. - Bethenny Frankel",
            "Eat breakfast like a king, lunch like a prince, and dinner like a pauper. - Adelle Davis",
            "The doctor of the future will no longer treat the human frame with drugs, but rather will cure and prevent disease with nutrition. - Thomas Edison",
            "To keep the body in good health is a duty... otherwise we shall not be able to keep our mind strong and clear. - Buddha",
            "Health is not about the weight you lose, but about the life you gain. - Dr. Josh Axe",
            "An apple a day keeps the doctor away. - Proverb",
            "You are what you eat, so don't be fast, cheap, easy, or fake. - Unknown"
        ];

        // Diet Plans
        const dietPlans = [
            {
                name: "üåø Mediterranean Diet",
                description: "Heart-healthy eating plan rich in fruits, vegetables, whole grains, and healthy fats",
                meals: [
                    "Breakfast: Greek yogurt with berries and nuts",
                    "Lunch: Grilled fish with quinoa and roasted vegetables",
                    "Dinner: Chickpea salad with olive oil dressing",
                    "Snacks: Fresh fruits, nuts, hummus with veggies"
                ]
            },
            {
                name: "üí™ High-Protein Plan",
                description: "Muscle building and weight management with lean proteins",
                meals: [
                    "Breakfast: Egg white omelet with spinach and turkey",
                    "Lunch: Grilled chicken breast with brown rice and broccoli",
                    "Dinner: Baked salmon with sweet potato and asparagus",
                    "Snacks: Protein shake, cottage cheese, almonds"
                ]
            },
            {
                name: "ü•ó Plant-Based Diet",
                description: "Nutrient-rich vegetarian plan for optimal health",
                meals: [
                    "Breakfast: Oatmeal with banana, chia seeds, and almond butter",
                    "Lunch: Lentil soup with whole grain bread and mixed greens",
                    "Dinner: Tofu stir-fry with vegetables and quinoa",
                    "Snacks: Fresh fruit, trail mix, veggie sticks with hummus"
                ]
            },
            {
                name: "‚ö° Keto Diet",
                description: "Low-carb, high-fat diet for weight loss and energy",
                meals: [
                    "Breakfast: Avocado and eggs with bacon",
                    "Lunch: Caesar salad with grilled chicken (no croutons)",
                    "Dinner: Steak with butter-saut√©ed mushrooms and cauliflower",
                    "Snacks: Cheese, nuts, keto fat bombs"
                ]
            },
            {
                name: "üåà Balanced Nutrition",
                description: "Well-rounded diet with all food groups in moderation",
                meals: [
                    "Breakfast: Whole grain toast with peanut butter and banana",
                    "Lunch: Turkey sandwich with vegetables and fruit",
                    "Dinner: Grilled chicken with pasta and mixed vegetables",
                    "Snacks: Yogurt, fruits, whole grain crackers"
                ]
            }
        ];

        // Enhanced Food Database
        const foodDatabase = {
            // HEALTHY FOODS
            'apple': { category: 'Fruits', freshness: 95, calories: 95, protein: '0.5g', carbs: '25g', fat: '0.3g', fiber: '4g', shelfLife: '1-2 weeks', type: 'healthy', confidence: 96.8, colors: ['red', 'green'], keywords: ['round', 'fruit'] },
            'banana': { category: 'Fruits', freshness: 90, calories: 105, protein: '1.3g', carbs: '27g', fat: '0.4g', fiber: '3g', shelfLife: '5-7 days', type: 'healthy', confidence: 95.3, colors: ['yellow'], keywords: ['curved', 'fruit'] },
            'orange': { category: 'Fruits', freshness: 94, calories: 62, protein: '1.2g', carbs: '15g', fat: '0.2g', fiber: '3.1g', shelfLife: '2 weeks', type: 'healthy', confidence: 95.8, colors: ['orange'], keywords: ['round', 'citrus'] },
            'strawberry': { category: 'Fruits', freshness: 88, calories: 32, protein: '0.7g', carbs: '7.7g', fat: '0.3g', fiber: '2g', shelfLife: '3-5 days', type: 'healthy', confidence: 93.2, colors: ['red'], keywords: ['berry', 'small'] },
            'grapes': { category: 'Fruits', freshness: 90, calories: 69, protein: '0.7g', carbs: '18g', fat: '0.2g', fiber: '0.9g', shelfLife: '1 week', type: 'healthy', confidence: 94.1, colors: ['purple', 'green'], keywords: ['cluster', 'small'] },
            'salad': { category: 'Vegetables', freshness: 92, calories: 150, protein: '5g', carbs: '20g', fat: '8g', fiber: '6g', shelfLife: '3-5 days', type: 'healthy', confidence: 94.2, colors: ['green'], keywords: ['leafy', 'mixed'] },
            'broccoli': { category: 'Vegetables', freshness: 89, calories: 55, protein: '4g', carbs: '11g', fat: '0.6g', fiber: '5g', shelfLife: '7-10 days', type: 'healthy', confidence: 93.7, colors: ['green'], keywords: ['tree', 'vegetable'] },
            'carrot': { category: 'Vegetables', freshness: 93, calories: 41, protein: '0.9g', carbs: '10g', fat: '0.2g', fiber: '3g', shelfLife: '2-3 weeks', type: 'healthy', confidence: 97.1, colors: ['orange'], keywords: ['long', 'root'] },
            'tomato': { category: 'Vegetables', freshness: 91, calories: 18, protein: '0.9g', carbs: '3.9g', fat: '0.2g', fiber: '1.2g', shelfLife: '1 week', type: 'healthy', confidence: 94.5, colors: ['red'], keywords: ['round', 'vegetable'] },
            'avocado': { category: 'Fruits', freshness: 87, calories: 160, protein: '2g', carbs: '9g', fat: '15g', fiber: '7g', shelfLife: '5-7 days', type: 'healthy', confidence: 92.6, colors: ['green', 'brown'], keywords: ['oval', 'creamy'] },
            'spinach': { category: 'Vegetables', freshness: 91, calories: 23, protein: '2.9g', carbs: '3.6g', fat: '0.4g', fiber: '2.2g', shelfLife: '5-7 days', type: 'healthy', confidence: 95.3, colors: ['green'], keywords: ['leafy', 'dark'] },
            'cucumber': { category: 'Vegetables', freshness: 92, calories: 16, protein: '0.7g', carbs: '3.6g', fat: '0.1g', fiber: '0.5g', shelfLife: '1 week', type: 'healthy', confidence: 93.9, colors: ['green'], keywords: ['long', 'cylindrical'] },
            
            // JUNK FOODS
            'pizza': { category: 'Fast Food', freshness: 35, calories: 285, protein: '12g', carbs: '36g', fat: '10g', fiber: '2g', shelfLife: '3-4 days', type: 'junk', confidence: 91.5, colors: ['red', 'yellow', 'brown'], keywords: ['round', 'cheese'] },
            'burger': { category: 'Fast Food', freshness: 28, calories: 540, protein: '25g', carbs: '45g', fat: '25g', fiber: '3g', shelfLife: '1-2 days', type: 'junk', confidence: 89.3, colors: ['brown', 'yellow'], keywords: ['bun', 'meat'] },
            'fries': { category: 'Fast Food', freshness: 25, calories: 365, protein: '4g', carbs: '48g', fat: '17g', fiber: '4g', shelfLife: '1 day', type: 'junk', confidence: 92.8, colors: ['yellow', 'golden'], keywords: ['stick', 'fried'] },
            'donut': { category: 'Desserts', freshness: 32, calories: 452, protein: '5g', carbs: '51g', fat: '25g', fiber: '1g', shelfLife: '2-3 days', type: 'junk', confidence: 94.1, colors: ['brown', 'pink', 'white'], keywords: ['round', 'hole', 'sweet'] },
            'chips': { category: 'Snacks', freshness: 40, calories: 536, protein: '7g', carbs: '53g', fat: '34g', fiber: '4g', shelfLife: '2-3 months', type: 'junk', confidence: 96.2, colors: ['yellow', 'brown'], keywords: ['crispy', 'thin'] },
            'candy': { category: 'Sweets', freshness: 30, calories: 394, protein: '0g', carbs: '100g', fat: '0g', fiber: '0g', shelfLife: '6-12 months', type: 'junk', confidence: 98.5, colors: ['red', 'blue', 'green', 'yellow'], keywords: ['small', 'colorful'] },
            'soda': { category: 'Beverages', freshness: 22, calories: 140, protein: '0g', carbs: '39g', fat: '0g', fiber: '0g', shelfLife: '6-9 months', type: 'junk', confidence: 99.1, colors: ['brown', 'clear'], keywords: ['liquid', 'bottle'] },
            'cake': { category: 'Desserts', freshness: 38, calories: 367, protein: '4g', carbs: '58g', fat: '14g', fiber: '1g', shelfLife: '3-5 days', type: 'junk', confidence: 93.4, colors: ['brown', 'white', 'pink'], keywords: ['layered', 'frosting'] },
            'cookie': { category: 'Desserts', freshness: 42, calories: 502, protein: '6g', carbs: '64g', fat: '25g', fiber: '2g', shelfLife: '2-3 weeks', type: 'junk', confidence: 95.7, colors: ['brown'], keywords: ['round', 'flat', 'sweet'] },
            'icecream': { category: 'Desserts', freshness: 33, calories: 207, protein: '4g', carbs: '24g', fat: '11g', fiber: '1g', shelfLife: '2-4 months', type: 'junk', confidence: 97.3, colors: ['white', 'brown', 'pink'], keywords: ['frozen', 'creamy'] },
            'hotdog': { category: 'Fast Food', freshness: 27, calories: 290, protein: '11g', carbs: '24g', fat: '17g', fiber: '1g', shelfLife: '1-2 days', type: 'junk', confidence: 90.8, colors: ['brown', 'red'], keywords: ['long', 'bun'] },
            'popcorn': { category: 'Snacks', freshness: 41, calories: 387, protein: '13g', carbs: '78g', fat: '5g', fiber: '15g', shelfLife: '2-3 months', type: 'junk', confidence: 92.3, colors: ['white', 'yellow'], keywords: ['fluffy', 'small'] }
        };

        // ADVANCED AI IMAGE ANALYSIS
        function analyzeImageContent(imageData) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    // Sample colors from image
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const pixels = imageData.data;
                    
                    let redCount = 0, greenCount = 0, blueCount = 0, yellowCount = 0, brownCount = 0, orangeCount = 0;
                    
                    // Sample every 10th pixel for performance
                    for (let i = 0; i < pixels.length; i += 40) {
                        const r = pixels[i];
                        const g = pixels[i + 1];
                        const b = pixels[i + 2];
                        
                        // Color detection logic
                        if (r > 150 && g < 100 && b < 100) redCount++; // Red
                        else if (g > 150 && r < 100 && b < 100) greenCount++; // Green
                        else if (r > 200 && g > 200 && b < 100) yellowCount++; // Yellow
                        else if (r > 150 && g > 100 && b < 100) orangeCount++; // Orange
                        else if (r > 100 && g > 50 && b < 50) brownCount++; // Brown
                    }
                    
                    // Determine dominant color
                    const colorScores = {
                        red: redCount,
                        green: greenCount,
                        yellow: yellowCount,
                        orange: orangeCount,
                        brown: brownCount
                    };
                    
                    const dominantColor = Object.keys(colorScores).reduce((a, b) => 
                        colorScores[a] > colorScores[b] ? a : b
                    );
                    
                    // Match to food based on color
                    let bestMatch = null;
                    let bestScore = 0;
                    
                    for (const [foodName, foodData] of Object.entries(foodDatabase)) {
                        let score = 0;
                        
                        // Check if dominant color matches food colors
                        if (foodData.colors && foodData.colors.includes(dominantColor)) {
                            score += 50;
                        }
                        
                        // Add some randomness for variety (10-30 points)
                        score += Math.random() * 20;
                        
                        if (score > bestScore) {
                            bestScore = score;
                            bestMatch = foodName;
                        }
                    }
                    
                    // If no good match, use intelligent fallback
                    if (!bestMatch || bestScore < 30) {
                        // Color-based fallback
                        const colorFoodMap = {
                            'red': ['apple', 'strawberry', 'tomato'],
                            'green': ['broccoli', 'spinach', 'cucumber', 'salad', 'grapes'],
                            'yellow': ['banana', 'fries'],
                            'orange': ['orange', 'carrot'],
                            'brown': ['burger', 'cookie', 'cake']
                        };
                        
                        const possibleFoods = colorFoodMap[dominantColor] || Object.keys(foodDatabase);
                        bestMatch = possibleFoods[Math.floor(Math.random() * possibleFoods.length)];
                    }
                    
                    resolve(bestMatch);
                };
                img.src = imageData;
            });
        }

        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            if (page === 'login') {
                document.getElementById('loginPage').classList.add('active');
            } else if (page === 'register') {
                document.getElementById('registerPage').classList.add('active');
            } else if (page === 'main') {
                document.getElementById('mainApp').classList.add('active');
                loadDashboard();
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const storedUser = JSON.parse(localStorage.getItem('freshscan_user') || '{}');
            
            if (storedUser.email && storedUser.email === email && storedUser.password === password) {
                currentUser = storedUser;
                document.getElementById('userName').textContent = currentUser.name;
                
                analysisHistory = JSON.parse(localStorage.getItem('freshscan_history_' + email) || '[]');
                
                showPage('main');
            } else {
                alert('Invalid credentials! Please check your email and password or create a new account.');
            }
        }

        function handleRegister(event) {
            event.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters long.');
                return;
            }

            localStorage.setItem('freshscan_user', JSON.stringify({ name, email, password }));
            
            alert('Account created successfully! Please login with your credentials.');
            
            document.getElementById('regName').value = '';
            document.getElementById('regEmail').value = '';
            document.getElementById('regPassword').value = '';
            document.getElementById('regConfirmPassword').value = '';
            
            showPage('login');
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                analysisHistory = [];
                document.getElementById('results').innerHTML = '';
                showPage('login');
            }
        }

        function switchMode(mode) {
            currentMode = mode;
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.mode-section').forEach(section => {
                section.classList.remove('active');
            });
            
            if (mode === 'dashboard') {
                document.getElementById('dashboardMode').classList.add('active');
                loadDashboard();
            } else if (mode === 'quick') {
                document.getElementById('quickMode').classList.add('active');
                loadFoodGrid();
            } else if (mode === 'advanced') {
                document.getElementById('advancedMode').classList.add('active');
            } else if (mode === 'history') {
                document.getElementById('historyMode').classList.add('active');
                loadHistory();
            } else if (mode === 'diet') {
                document.getElementById('dietMode').classList.add('active');
                loadDietPlans();
            }
            
            document.getElementById('results').innerHTML = '';
        }

        function loadDashboard() {
            const quoteIndex = new Date().getDate() % healthQuotes.length;
            document.getElementById('dailyQuote').textContent = healthQuotes[quoteIndex];
            
            const totalScans = analysisHistory.length;
            const healthyCount = analysisHistory.filter(item => item.type === 'healthy').length;
            const junkCount = analysisHistory.filter(item => item.type === 'junk').length;
            const avgScore = totalScans > 0 ? Math.round(analysisHistory.reduce((sum, item) => sum + item.score, 0) / totalScans) : 0;
            
            document.getElementById('totalScans').textContent = totalScans;
            document.getElementById('healthyCount').textContent = healthyCount;
            document.getElementById('junkCount').textContent = junkCount;
            document.getElementById('avgScore').textContent = avgScore + '%';
            
            createWeeklyChart();
            createCategoryChart();
        }

        function createWeeklyChart() {
            const ctx = document.getElementById('weeklyChart');
            if (!ctx) return;
            
            if (weeklyChart) {
                weeklyChart.destroy();
            }
            
            const last7Days = [];
            const scores = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                last7Days.push(dateStr);
                
                const dayScans = analysisHistory.filter(item => {
                    const itemDate = new Date(item.timestamp);
                    return itemDate.toDateString() === date.toDateString();
                });
                
                const avgScore = dayScans.length > 0 
                    ? dayScans.reduce((sum, item) => sum + item.score, 0) / dayScans.length 
                    : 0;
                scores.push(Math.round(avgScore));
            }
            
            weeklyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: 'Health Score',
                        data: scores,
                        borderColor: '#14b8a6',
                        backgroundColor: 'rgba(20, 184, 166, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function createCategoryChart() {
            const ctx = document.getElementById('categoryChart');
            if (!ctx) return;
            
            if (categoryChart) {
                categoryChart.destroy();
            }
            
            const categories = {};
            analysisHistory.forEach(item => {
                categories[item.category] = (categories[item.category] || 0) + 1;
            });
            
            categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        data: Object.values(categories),
                        backgroundColor: [
                            '#10b981',
                            '#14b8a6',
                            '#06b6d4',
                            '#3b82f6',
                            '#8b5cf6',
                            '#ef4444'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function loadFoodGrid() {
            const grid = document.getElementById('foodGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            const foodItems = [
                { key: 'apple', emoji: 'üçé', name: 'Apple', type: 'Healthy' },
                { key: 'banana', emoji: 'üçå', name: 'Banana', type: 'Healthy' },
                { key: 'orange', emoji: 'üçä', name: 'Orange', type: 'Healthy' },
                { key: 'strawberry', emoji: 'üçì', name: 'Strawberry', type: 'Healthy' },
                { key: 'grapes', emoji: 'üçá', name: 'Grapes', type: 'Healthy' },
                { key: 'salad', emoji: 'ü•ó', name: 'Salad', type: 'Healthy' },
                { key: 'broccoli', emoji: 'ü•¶', name: 'Broccoli', type: 'Healthy' },
                { key: 'carrot', emoji: 'ü•ï', name: 'Carrot', type: 'Healthy' },
                { key: 'tomato', emoji: 'üçÖ', name: 'Tomato', type: 'Healthy' },
                { key: 'avocado', emoji: 'ü•ë', name: 'Avocado', type: 'Healthy' },
                { key: 'spinach', emoji: 'ü•¨', name: 'Spinach', type: 'Healthy' },
                { key: 'cucumber', emoji: 'ü•í', name: 'Cucumber', type: 'Healthy' },
                { key: 'pizza', emoji: 'üçï', name: 'Pizza', type: 'Junk Food' },
                { key: 'burger', emoji: 'üçî', name: 'Burger', type: 'Junk Food' },
                { key: 'fries', emoji: 'üçü', name: 'Fries', type: 'Junk Food' },
                { key: 'donut', emoji: 'üç©', name: 'Donut', type: 'Junk Food' },
                { key: 'chips', emoji: 'ü•®', name: 'Chips', type: 'Junk Food' },
                { key: 'candy', emoji: 'üç¨', name: 'Candy', type: 'Junk Food' },
                { key: 'soda', emoji: 'ü•§', name: 'Soda', type: 'Junk Food' },
                { key: 'cake', emoji: 'üç∞', name: 'Cake', type: 'Junk Food' },
                { key: 'cookie', emoji: 'üç™', name: 'Cookie', type: 'Junk Food' },
                { key: 'icecream', emoji: 'üç¶', name: 'Ice Cream', type: 'Junk Food' },
                { key: 'hotdog', emoji: 'üå≠', name: 'Hot Dog', type: 'Junk Food' },
                { key: 'popcorn', emoji: 'üçø', name: 'Popcorn', type: 'Junk Food' }
            ];
            
            foodItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'food-item';
                div.onclick = () => selectFood(item.key);
                div.innerHTML = `
                    <div class="emoji">${item.emoji}</div>
                    <div class="name">${item.name}</div>
                    <div class="type">${item.type}</div>
                `;
                grid.appendChild(div);
            });
        }

        function selectFood(foodType) {
            document.querySelectorAll('.food-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').innerHTML = '';
            
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                displayResults(foodType);
                saveToHistory(foodType);
            }, 2000);
        }

        // Upload functionality
        const fileInput = document.getElementById('fileInput');
        const uploadCard = document.getElementById('uploadCard');
        const previewSection = document.getElementById('previewSection');
        const previewImage = document.getElementById('previewImage');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            if (uploadCard) {
                uploadCard.addEventListener(eventName, preventDefaults, false);
            }
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            if (uploadCard) {
                uploadCard.addEventListener(eventName, () => {
                    uploadCard.classList.add('dragover');
                }, false);
            }
        });

        ['dragleave', 'drop'].forEach(eventName => {
            if (uploadCard) {
                uploadCard.addEventListener(eventName, () => {
                    uploadCard.classList.remove('dragover');
                }, false);
            }
        });

        if (uploadCard) {
            uploadCard.addEventListener('drop', (e) => {
                const dt = e.dataTransfer;
                const files = dt.files;
                if (files.length > 0) {
                    handleImageUpload(files[0]);
                }
            }, false);
        }

        if (fileInput) {
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleImageUpload(file);
                }
            });
        }

        function handleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please upload an image file!');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedImage = e.target.result;
                previewImage.src = uploadedImage;
                uploadCard.style.display = 'none';
                previewSection.classList.add('active');
                document.getElementById('results').innerHTML = '';
                document.getElementById('processingSteps').classList.remove('active');
            };
            reader.readAsDataURL(file);
        }

        function resetUpload() {
            uploadCard.style.display = 'block';
            previewSection.classList.remove('active');
            document.getElementById('results').innerHTML = '';
            document.getElementById('processingSteps').classList.remove('active');
            fileInput.value = '';
            uploadedImage = null;
        }

        async function analyzeUploadedImage() {
            previewSection.classList.remove('active');
            document.getElementById('processingSteps').classList.add('active');
            document.getElementById('results').innerHTML = '';
            
            const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
            let currentStep = 0;
            
            function processStep() {
                if (currentStep > 0) {
                    document.getElementById(steps[currentStep - 1]).classList.remove('processing');
                    document.getElementById(steps[currentStep - 1]).classList.add('completed');
                }
                
                if (currentStep < steps.length) {
                    document.getElementById(steps[currentStep]).classList.add('processing');
                    currentStep++;
                    setTimeout(processStep, 1000);
                } else {
                    setTimeout(async () => {
                        document.getElementById('processingSteps').classList.remove('active');
                        previewSection.classList.add('active');
                        
                        steps.forEach(step => {
                            document.getElementById(step).classList.remove('processing', 'completed');
                        });
                        
                        // Analyze image with AI
                        const detectedFood = await analyzeImageContent(uploadedImage);
                        displayResults(detectedFood);
                        saveToHistory(detectedFood);
                    }, 500);
                }
            }
            
            processStep();
        }

        function displayResults(foodType) {
            const foodData = foodDatabase[foodType];
            if (!foodData) return;
            
            const foodName = foodType.charAt(0).toUpperCase() + foodType.slice(1);
            const isHealthy = foodData.type === 'healthy';
            
            let freshnessColor = 'poor';
            let freshnessStatus = 'Poor Quality - Unhealthy';
            
            if (foodData.freshness >= 75) {
                freshnessColor = 'fresh';
                freshnessStatus = 'Excellent Quality - Very Healthy';
            } else if (foodData.freshness >= 55) {
                freshnessColor = 'moderate';
                freshnessStatus = 'Moderate Quality';
            }
            
            const healthWarning = !isHealthy ? `
                <div style="background: #fee2e2; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #dc2626;">
                    <strong style="color: #991b1b;">üö´ DANGER - Unhealthy Food!</strong>
                    <p style="color: #991b1b; margin-top: 5px; font-size: 0.95em;">Highly processed junk food. High in calories, unhealthy fats, and artificial additives. <strong>Avoid or limit consumption!</strong></p>
                </div>
            ` : `
                <div style="background: #d1fae5; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #10b981;">
                    <strong style="color: #065f46;">‚úÖ HEALTHY FOOD - Excellent Choice!</strong>
                    <p style="color: #065f46; margin-top: 5px; font-size: 0.95em;">Natural, nutrient-dense food. Rich in vitamins, minerals, and fiber. <strong>Highly recommended!</strong></p>
                </div>
            `;

            const resultsHTML = `
                <div class="results-section">
                    <div class="result-card">
                        <h3><span class="icon">üçΩÔ∏è</span> Food Classification</h3>
                        <div class="llm-badge">ü§ñ AI Vision Analysis</div>
                        <div class="confidence-score">
                            <strong>AI Confidence: ${foodData.confidence}%</strong>
                        </div>
                        <h4 style="color: ${isHealthy ? '#10b981' : '#dc2626'}; margin: 15px 0; font-size: 1.6em; font-weight: 800;">${foodName}</h4>
                        <p>
                            <span class="tag tag-primary">${foodData.category}</span>
                            <span class="tag ${isHealthy ? 'tag-success' : 'tag-danger'}" style="font-size: 1em; padding: 8px 18px;">
                                ${isHealthy ? '‚úÖ HEALTHY' : 'üö´ JUNK FOOD'}
                            </span>
                        </p>
                        ${healthWarning}
                    </div>

                    <div class="result-card">
                        <h3><span class="icon">${isHealthy ? 'üåø' : '‚ö†Ô∏è'}</span> Health Score</h3>
                        <div class="freshness-indicator">
                            <div class="freshness-bar">
                                <div class="freshness-fill ${freshnessColor}" style="width: ${foodData.freshness}%"></div>
                            </div>
                            <strong style="color: ${freshnessColor === 'fresh' ? '#10b981' : freshnessColor === 'moderate' ? '#f59e0b' : '#dc2626'}; font-size: 1.4em; font-weight: 800;">${foodData.freshness}%</strong>
                        </div>
                        <p style="margin-top: 15px;">
                            <span class="tag ${freshnessColor === 'fresh' ? 'tag-success' : freshnessColor === 'moderate' ? 'tag-warning' : 'tag-danger'}" style="font-size: 1em; padding: 8px 18px;">
                                ${freshnessStatus}
                            </span>
                        </p>
                    </div>

                    <div class="result-card">
                        <h3><span class="icon">üìä</span> Nutrition Facts</h3>
                        <div class="nutrition-table">
                            <div class="nutrition-row">
                                <span><strong>Calories</strong></span>
                                <span style="color: ${foodData.calories > 300 ? '#dc2626' : '#10b981'}; font-weight: 700;">
                                    ${foodData.calories} kcal ${foodData.calories > 300 ? '‚ö†Ô∏è' : '‚úÖ'}
                                </span>
                            </div>
                            <div class="nutrition-row">
                                <span>Protein</span>
                                <span>${foodData.protein}</span>
                            </div>
                            <div class="nutrition-row">
                                <span>Carbs</span>
                                <span>${foodData.carbs}</span>
                            </div>
                            <div class="nutrition-row">
                                <span>Fat</span>
                                <span style="color: ${parseInt(foodData.fat) > 15 ? '#dc2626' : '#10b981'}; font-weight: 700;">
                                    ${foodData.fat} ${parseInt(foodData.fat) > 15 ? '‚ö†Ô∏è' : '‚úÖ'}
                                </span>
                            </div>
                            <div class="nutrition-row">
                                <span>Fiber</span>
                                <span>${foodData.fiber}</span>
                            </div>
                        </div>
                    </div>

                    <div class="result-card">
                        <h3><span class="icon">‚è∞</span> Storage Info</h3>
                        <p style="margin: 15px 0;"><strong>Shelf Life:</strong> ${foodData.shelfLife}</p>
                        <p><strong>Storage:</strong> ${isHealthy ? 'Refrigerate at 2-4¬∞C' : 'Store in cool, dry place'}</p>
                        ${!isHealthy ? `
                            <div style="margin-top: 15px; padding: 12px; background: #fee2e2; border-radius: 8px;">
                                <p style="color: #991b1b; font-weight: 700;">üö´ LIMIT CONSUMPTION</p>
                            </div>
                        ` : `
                            <div style="margin-top: 15px; padding: 12px; background: #d1fae5; border-radius: 8px;">
                                <p style="color: #065f46; font-weight: 700;">‚úÖ EXCELLENT FOR DAILY DIET</p>
                            </div>
                        `}
                    </div>
                </div>
            `;

            document.getElementById('results').innerHTML = resultsHTML;
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function saveToHistory(foodType) {
            const foodData = foodDatabase[foodType];
            if (!foodData || !currentUser) return;
            
            const historyItem = {
                food: foodType,
                category: foodData.category,
                type: foodData.type,
                score: foodData.freshness,
                timestamp: new Date().toISOString()
            };
            
            analysisHistory.unshift(historyItem);
            
            if (analysisHistory.length > 50) {
                analysisHistory = analysisHistory.slice(0, 50);
            }
            
            localStorage.setItem('freshscan_history_' + currentUser.email, JSON.stringify(analysisHistory));
            
            if (currentMode === 'dashboard') {
                loadDashboard();
            }
        }

        function loadHistory() {
            const historyList = document.getElementById('historyList');
            if (!historyList) return;
            
            if (analysisHistory.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #64748b; padding: 40px;">No analysis history yet. Start scanning foods!</p>';
                return;
            }
            
            historyList.innerHTML = analysisHistory.map(item => {
                const emoji = {
                    'apple': 'üçé', 'banana': 'üçå', 'orange': 'üçä', 'strawberry': 'üçì', 'grapes': 'üçá',
                    'salad': 'ü•ó', 'broccoli': 'ü•¶', 'carrot': 'ü•ï', 'tomato': 'üçÖ', 'avocado': 'ü•ë',
                    'spinach': 'ü•¨', 'cucumber': 'ü•í', 'pizza': 'üçï', 'burger': 'üçî', 'fries': 'üçü',
                    'donut': 'üç©', 'chips': 'ü•®', 'candy': 'üç¨', 'soda': 'ü•§', 'cake': 'üç∞',
                    'cookie': 'üç™', 'icecream': 'üç¶', 'hotdog': 'üå≠', 'popcorn': 'üçø'
                }[item.food] || 'üçΩÔ∏è';
                
                const date = new Date(item.timestamp).toLocaleString();
                const scoreClass = item.type === 'healthy' ? 'healthy' : 'unhealthy';
                
                return `
                    <div class="history-item">
                        <div class="emoji">${emoji}</div>
                        <div class="details">
                            <h4>${item.food.charAt(0).toUpperCase() + item.food.slice(1)}</h4>
                            <p>${item.category} ‚Ä¢ ${date}</p>
                        </div>
                        <div class="score ${scoreClass}">${item.score}%</div>
                    </div>
                `;
            }).join('');
        }

        function loadDietPlans() {
            const dietPlansContainer = document.getElementById('dietPlans');
            if (!dietPlansContainer) return;
            
            dietPlansContainer.innerHTML = dietPlans.map(plan => `
                <div class="diet-plan-card">
                    <h3>${plan.name}</h3>
                    <p style="color: #64748b; margin-bottom: 15px;">${plan.description}</p>
                    <ul>
                        ${plan.meals.map(meal => `<li>${meal}</li>`).join('')}
                    </ul>
                </div>
            `).join('');
        }

        // Initialize
        showPage('login');
    </script>
</body>
</html>