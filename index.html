<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodCycle AI - Smart Food Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 50%, #2dd4bf 100%);
            min-height: 100vh;
            padding: 0;
        }

        .page {
            display: none;
            min-height: 100vh;
        }

        .page.active {
            display: flex;
        }

        /* Login Page */
        .login-page {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        .login-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            overflow: hidden;
            max-width: 1100px;
            width: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            min-height: 600px;
        }

        .login-left {
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
            color: white;
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .login-left h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            font-weight: 700;
            line-height: 1.2;
        }

        .login-left .subtitle {
            font-size: 1.15em;
            opacity: 0.95;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .feature-list {
            list-style: none;
            margin-top: 20px;
        }

        .feature-list li {
            padding: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.05em;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .feature-list li:last-child {
            border-bottom: none;
        }

        .feature-list li::before {
            content: "‚úì";
            background: rgba(255,255,255,0.25);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .login-right {
            padding: 60px 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .login-header {
            margin-bottom: 35px;
        }

        .login-header h2 {
            color: #0f766e;
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .login-header p {
            color: #64748b;
            font-size: 1em;
        }

        .form-group {
            margin-bottom: 22px;
        }

        .form-group label {
            display: block;
            color: #334155;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 0.95em;
        }

        .form-group input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
            background: #f8fafc;
        }

        .form-group input:focus {
            outline: none;
            border-color: #14b8a6;
            background: white;
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 10px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(20, 184, 166, 0.4);
        }

        .btn-secondary {
            background: #64748b;
            box-shadow: 0 4px 12px rgba(100, 116, 139, 0.3);
        }

        .auth-footer {
            text-align: center;
            margin-top: 25px;
            color: #64748b;
            font-size: 0.95em;
        }

        .auth-footer a {
            color: #0f766e;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        /* Register Page */
        .register-container {
            max-width: 550px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            padding: 50px;
        }

        /* Main App */
        .main-app {
            width: 100%;
            background: #f1f5f9;
        }

        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .navbar-brand .logo {
            font-size: 1.8em;
        }

        .navbar-brand .brand-text h1 {
            font-size: 1.5em;
            font-weight: 700;
            color: #0f766e;
            line-height: 1.2;
        }

        .navbar-brand .brand-text p {
            font-size: 0.8em;
            color: #64748b;
            margin-top: 2px;
        }

        .navbar-right {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: #f0fdfa;
            border-radius: 25px;
            color: #0f766e;
            font-weight: 600;
        }

        .btn-small {
            padding: 10px 24px;
            font-size: 0.95em;
            width: auto;
        }

        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
        }

        .content-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .content-header h1 {
            color: #0f172a;
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .content-header p {
            color: #64748b;
            font-size: 1.2em;
        }

        .upload-card {
            background: white;
            border-radius: 20px;
            padding: 60px;
            text-align: center;
            margin-bottom: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 3px dashed #cbd5e1;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-card:hover {
            border-color: #14b8a6;
            background: #f0fdfa;
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(20, 184, 166, 0.15);
        }

        .upload-card.dragover {
            border-color: #0f766e;
            background: #ccfbf1;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 5em;
            margin-bottom: 25px;
        }

        .upload-card h2 {
            color: #0f172a;
            margin-bottom: 15px;
            font-size: 1.8em;
            font-weight: 700;
        }

        .upload-card p {
            color: #64748b;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        #fileInput {
            display: none;
        }

        .preview-section {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 40px;
        }

        .preview-image {
            width: 100%;
            max-width: 600px;
            border-radius: 15px;
            margin: 0 auto 30px;
            display: block;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .results-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            animation: slideUp 0.5s ease;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.12);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-card h3 {
            color: #0f172a;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4em;
            font-weight: 700;
        }

        .result-card .icon {
            font-size: 1.6em;
        }

        .freshness-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
        }

        .freshness-bar {
            flex: 1;
            height: 24px;
            background: #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
        }

        .freshness-fill {
            height: 100%;
            transition: width 1.5s ease;
            border-radius: 12px;
        }

        .fresh { background: linear-gradient(90deg, #10b981 0%, #34d399 100%); }
        .moderate { background: linear-gradient(90deg, #f59e0b 0%, #fbbf24 100%); }
        .poor { background: linear-gradient(90deg, #ef4444 0%, #f87171 100%); }

        .nutrition-table {
            width: 100%;
            margin-top: 20px;
        }

        .nutrition-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
            font-size: 1.05em;
        }

        .nutrition-row:last-child {
            border-bottom: none;
        }

        .shelf-life-timeline {
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            font-size: 1.05em;
        }

        .timeline-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #14b8a6;
            flex-shrink: 0;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 60px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .spinner {
            border: 5px solid #f1f5f9;
            border-top: 5px solid #14b8a6;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tag {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            margin: 5px 5px 5px 0;
            font-weight: 600;
        }

        .tag-primary { background: #ccfbf1; color: #0f766e; }
        .tag-success { background: #d1fae5; color: #065f46; }
        .tag-warning { background: #fef3c7; color: #92400e; }
        .tag-danger { background: #fee2e2; color: #991b1b; }

        /* Chat Assistant */
        .chat-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
            color: white;
            border: none;
            font-size: 2em;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(20, 184, 166, 0.4);
            transition: all 0.3s;
            z-index: 1000;
            display: none;
        }

        .chat-button.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(20, 184, 166, 0.5);
        }

        .chat-window {
            position: fixed;
            bottom: 110px;
            right: 30px;
            width: 400px;
            height: 550px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }

        .chat-window.active {
            display: flex;
        }

        .chat-header {
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
            color: white;
            padding: 25px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            font-size: 1.3em;
            font-weight: 700;
        }

        .chat-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .chat-close:hover {
            background: rgba(255,255,255,0.3);
        }

        .chat-messages {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: #f8fafc;
        }

        .chat-message {
            margin-bottom: 18px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-message.bot {
            text-align: left;
        }

        .chat-message.user {
            text-align: right;
        }

        .message-bubble {
            display: inline-block;
            padding: 14px 20px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
            font-size: 0.98em;
            line-height: 1.5;
        }

        .chat-message.bot .message-bubble {
            background: white;
            color: #334155;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .chat-message.user .message-bubble {
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
            color: white;
        }

        .chat-input-area {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 12px;
            background: white;
            border-radius: 0 0 20px 20px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 0.95em;
            transition: all 0.3s;
        }

        .chat-input:focus {
            outline: none;
            border-color: #14b8a6;
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
        }

        .chat-send {
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .chat-send:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.3);
        }

        @media (max-width: 968px) {
            .login-container {
                grid-template-columns: 1fr;
            }
            
            .login-left {
                display: none;
            }

            .navbar {
                padding: 15px 20px;
            }

            .navbar-brand .brand-text h1 {
                font-size: 1.2em;
            }

            .main-content {
                padding: 20px;
            }

            .upload-card {
                padding: 40px 20px;
            }

            .results-section {
                grid-template-columns: 1fr;
            }

            .chat-window {
                width: calc(100% - 40px);
                right: 20px;
                bottom: 100px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="page active">
        <div class="login-page">
            <div class="login-container">
                <div class="login-left">
                    <h1>üçé FoodCycle AI</h1>
                    <p class="subtitle">Smart food management powered by artificial intelligence. Analyze freshness, get nutritional insights, and reduce food waste.</p>
                    
                    <ul class="feature-list">
                        <li>Instant freshness detection</li>
                        <li>Accurate food classification</li>
                        <li>Detailed nutrition analysis</li>
                        <li>Smart shelf life prediction</li>
                        <li>24/7 AI assistant support</li>
                    </ul>
                </div>
                <div class="login-right">
                    <div class="login-header">
                        <h2>Welcome Back</h2>
                        <p>Sign in to your account</p>
                    </div>
                    <form onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" id="loginEmail" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" placeholder="Enter your password" required>
                        </div>
                        <button type="submit" class="btn">Sign In</button>
                    </form>
                    <div class="auth-footer">
                        Don't have an account? <a onclick="showPage('register')">Sign Up</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Page -->
    <div id="registerPage" class="page">
        <div class="login-page">
            <div class="register-container">
                <div class="login-header">
                    <h2>Create Account</h2>
                    <p>Join FoodCycle AI today</p>
                </div>
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="regName" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="regEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="regPassword" placeholder="Create a password (min 6 characters)" required>
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="regConfirmPassword" placeholder="Confirm your password" required>
                    </div>
                    <button type="submit" class="btn">Create Account</button>
                </form>
                <div class="auth-footer">
                    Already have an account? <a onclick="showPage('login')">Sign In</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="page">
        <div class="main-app">
            <nav class="navbar">
                <div class="navbar-brand">
                    <span class="logo">üçé</span>
                    <div class="brand-text">
                        <h1>FoodCycle AI</h1>
                        <p>Smart Food Management</p>
                    </div>
                </div>
                <div class="navbar-right">
                    <div class="user-badge">
                        <span>üë§</span>
                        <span id="userName">User</span>
                    </div>
                    <button class="btn btn-small btn-secondary" onclick="handleLogout()">Logout</button>
                </div>
            </nav>

            <div class="main-content">
                <div class="content-header">
                    <h1>Food Analysis Dashboard</h1>
                    <p>Upload any food image for instant AI-powered analysis</p>
                </div>

                <div class="upload-card" id="uploadCard">
                    <div class="upload-icon">üì∏</div>
                    <h2>Upload Food Image</h2>
                    <p>Drag and drop or click to browse</p>
                    <input type="file" id="fileInput" accept="image/*">
                    <button class="btn" onclick="document.getElementById('fileInput').click()">
                        Choose Image
                    </button>
                </div>

                <div class="preview-section" id="previewSection">
                    <img id="previewImage" class="preview-image" alt="Food preview">
                    <div class="action-buttons">
                        <button class="btn" onclick="analyzeFood()">üîç Analyze Food</button>
                        <button class="btn btn-secondary" onclick="resetApp()">üîÑ Upload New Image</button>
                    </div>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <h3 style="color: #0f766e; margin-bottom: 10px;">Analyzing Your Food...</h3>
                    <p style="color: #64748b;">Our AI is processing the image</p>
                </div>

                <div id="results"></div>
            </div>
        </div>
    </div>

    <!-- Chat Assistant -->
    <button class="chat-button" id="chatButton" onclick="toggleChat()">üí¨</button>
    
    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <h3>ü§ñ Food Assistant</h3>
            <button class="chat-close" onclick="toggleChat()">√ó</button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="chat-message bot">
                <div class="message-bubble">
                    Hi! I'm your Food Assistant. Ask me about food storage, nutrition, recipes, or shelf life! üçé
                </div>
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything..." onkeypress="handleChatKeyPress(event)">
            <button class="chat-send" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentImageData = null;

        // Food database with realistic data
        const foodDatabase = {
            // Healthy foods - HIGH freshness scores (80-95)
            'salad': { category: 'Vegetables', freshness: 85, calories: 150, protein: '5g', carbs: '20g', fat: '8g', fiber: '6g', shelfLife: '3-5 days', type: 'healthy' },
            'apple': { category: 'Fruits', freshness: 90, calories: 95, protein: '0.5g', carbs: '25g', fat: '0.3g', fiber: '4g', shelfLife: '1-2 weeks', type: 'healthy' },
            'banana': { category: 'Fruits', freshness: 88, calories: 105, protein: '1.3g', carbs: '27g', fat: '0.4g', fiber: '3g', shelfLife: '5-7 days', type: 'healthy' },
            'broccoli': { category: 'Vegetables', freshness: 87, calories: 55, protein: '4g', carbs: '11g', fat: '0.6g', fiber: '5g', shelfLife: '7-10 days', type: 'healthy' },
            'carrot': { category: 'Vegetables', freshness: 92, calories: 41, protein: '0.9g', carbs: '10g', fat: '0.2g', fiber: '3g', shelfLife: '2-3 weeks', type: 'healthy' },
            
            // Junk foods - LOW freshness scores (35-60) - PROCESSED/UNHEALTHY
            'pizza': { category: 'Fast Food', freshness: 50, calories: 285, protein: '12g', carbs: '36g', fat: '10g', fiber: '2g', shelfLife: '3-4 days', type: 'junk' },
            'burger': { category: 'Fast Food', freshness: 45, calories: 540, protein: '25g', carbs: '45g', fat: '25g', fiber: '3g', shelfLife: '1-2 days', type: 'junk' },
            'fries': { category: 'Fast Food', freshness: 40, calories: 365, protein: '4g', carbs: '48g', fat: '17g', fiber: '4g', shelfLife: '1 day', type: 'junk' },
            'donut': { category: 'Desserts', freshness: 55, calories: 452, protein: '5g', carbs: '51g', fat: '25g', fiber: '1g', shelfLife: '2-3 days', type: 'junk' },
            'chips': { category: 'Snacks', freshness: 60, calories: 536, protein: '7g', carbs: '53g', fat: '34g', fiber: '4g', shelfLife: '2-3 months', type: 'junk' },
            'candy': { category: 'Sweets', freshness: 50, calories: 394, protein: '0g', carbs: '100g', fat: '0g', fiber: '0g', shelfLife: '6-12 months', type: 'junk' },
            'soda': { category: 'Beverages', freshness: 35, calories: 140, protein: '0g', carbs: '39g', fat: '0g', fiber: '0g', shelfLife: '6-9 months', type: 'junk' },
            'cake': { category: 'Desserts', freshness: 58, calories: 367, protein: '4g', carbs: '58g', fat: '14g', fiber: '1g', shelfLife: '3-5 days', type: 'junk' },
            'cookie': { category: 'Desserts', freshness: 55, calories: 502, protein: '6g', carbs: '64g', fat: '25g', fiber: '2g', shelfLife: '2-3 weeks', type: 'junk' },
            'icecream': { category: 'Desserts', freshness: 52, calories: 207, protein: '4g', carbs: '24g', fat: '11g', fiber: '1g', shelfLife: '2-4 months', type: 'junk' }
        };

        function detectFoodType(imageSrc) {
            const keywords = ['pizza', 'burger', 'fries', 'donut', 'chips', 'candy', 'soda', 'cake', 'cookie', 'icecream', 
                            'salad', 'apple', 'banana', 'broccoli', 'carrot'];
            
            const randomFood = keywords[Math.floor(Math.random() * keywords.length)];
            return randomFood;
        }

        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            if (page === 'login') {
                document.getElementById('loginPage').classList.add('active');
                document.getElementById('chatButton').classList.remove('show');
            } else if (page === 'register') {
                document.getElementById('registerPage').classList.add('active');
                document.getElementById('chatButton').classList.remove('show');
            } else if (page === 'main') {
                document.getElementById('mainApp').classList.add('active');
                document.getElementById('chatButton').classList.add('show');
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const storedUser = JSON.parse(localStorage.getItem('foodcycle_user') || '{}');
            
            if (storedUser.email && storedUser.email === email && storedUser.password === password) {
                currentUser = storedUser;
                document.getElementById('userName').textContent = currentUser.name;
                showPage('main');
            } else {
                alert('Invalid credentials! Please check your email and password or create a new account.');
            }
        }

        function handleRegister(event) {
            event.preventDefault();
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters long.');
                return;
            }

            // Save user with password
            localStorage.setItem('foodcycle_user', JSON.stringify({ name, email, password }));
            currentUser = { name, email, password };
            
            alert('Account created successfully! Logging you in...');
            document.getElementById('userName').textContent = currentUser.name;
            showPage('main');
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                resetApp();
                showPage('login');
            }
        }

        const uploadCard = document.getElementById('uploadCard');
        const fileInput = document.getElementById('fileInput');
        const previewSection = document.getElementById('previewSection');
        const previewImage = document.getElementById('previewImage');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');

        uploadCard.addEventListener('click', () => {
            fileInput.click();
        });

        uploadCard.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadCard.classList.add('dragover');
        });

        uploadCard.addEventListener('dragleave', () => {
            uploadCard.classList.remove('dragover');
        });

        uploadCard.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadCard.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleImageUpload(file);
            }
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleImageUpload(file);
            }
        });

        function handleImageUpload(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                currentImageData = e.target.result;
                previewImage.src = currentImageData;
                uploadCard.style.display = 'none';
                previewSection.style.display = 'block';
                results.innerHTML = '';
            };
            reader.readAsDataURL(file);
        }

        function analyzeFood() {
            loading.style.display = 'block';
            results.innerHTML = '';
            previewSection.style.display = 'none';

            setTimeout(() => {
                loading.style.display = 'none';
                previewSection.style.display = 'block';
                displayResults();
            }, 2500);
        }

        function displayResults() {
            const detectedFood = detectFoodType(currentImageData);
            const foodData = foodDatabase[detectedFood];
            
            const foodName = detectedFood.charAt(0).toUpperCase() + detectedFood.slice(1);
            const isHealthy = foodData.type === 'healthy';
            
            // Determine freshness color based on score
            let freshnessColor = 'poor';
            let freshnessStatus = 'Poor Quality';
            if (foodData.freshness >= 75) {
                freshnessColor = 'fresh';
                freshnessStatus = 'Fresh & Healthy';
            } else if (foodData.freshness >= 55) {
                freshnessColor = 'moderate';
                freshnessStatus = 'Moderate Quality';
            }
            
            const healthWarning = !isHealthy ? `
                <div style="background: #fee2e2; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #dc2626;">
                    <strong style="color: #991b1b;">üö´ Health Warning:</strong>
                    <p style="color: #991b1b; margin-top: 5px; font-size: 0.95em;">This is a processed/junk food item. High in calories, unhealthy fats, and low in essential nutrients. Regular consumption may lead to health issues. Consider healthier alternatives!</p>
                </div>
            ` : '';

            const resultsHTML = `
                <div class="results-section">
                    <div class="result-card">
                        <h3><span class="icon">üçΩÔ∏è</span> Food Classification</h3>
                        <h4 style="color: ${isHealthy ? '#0f766e' : '#dc2626'}; margin: 15px 0; font-size: 1.4em;">${foodName}</h4>
                        <p>
                            <span class="tag tag-primary">${foodData.category}</span>
                            <span class="tag ${isHealthy ? 'tag-success' : 'tag-danger'}">${isHealthy ? '‚úì Healthy Food' : '‚ö†Ô∏è Junk Food'}</span>
                        </p>
                        ${healthWarning}
                    </div>

                    <div class="result-card">
                        <h3><span class="icon">${isHealthy ? 'üåø' : '‚ö†Ô∏è'}</span> Freshness Analysis</h3>
                        <div class="freshness-indicator">
                            <div class="freshness-bar">
                                <div class="freshness-fill ${freshnessColor}" 
                                     style="width: ${foodData.freshness}%"></div>
                            </div>
                            <strong style="color: ${freshnessColor === 'fresh' ? '#10b981' : freshnessColor === 'moderate' ? '#f59e0b' : '#ef4444'}; font-size: 1.2em;">${foodData.freshness}%</strong>
                        </div>
                        <p style="margin-top: 15px;">
                            <span class="tag ${freshnessColor === 'fresh' ? 'tag-success' : freshnessColor === 'moderate' ? 'tag-warning' : 'tag-danger'}">
                                ${freshnessStatus}
                            </span>
                        </p>
                        <p style="margin-top: 15px; color: #64748b; line-height: 1.6;">
                            ${isHealthy ? 
                                'Natural, unprocessed food with high nutritional value and freshness.' : 
                                'Highly processed food with artificial additives, preservatives, and low nutritional quality. Not recommended for regular consumption.'}
                        </p>
                    </div>

                    <div class="result-card">
                        <h3><span class="icon">üìä</span> Nutrition Facts</h3>
                        <div class="nutrition-table">
                            <div class="nutrition-row">
                                <span><strong>Calories</strong></span>
                                <span style="color: ${foodData.calories > 300 ? '#dc2626' : '#0f766e'}; font-weight: 600;">${foodData.calories} kcal ${foodData.calories > 300 ? '‚ö†Ô∏è' : ''}</span>
                            </div>
                            <div class="nutrition-row">
                                <span>Protein</span>
                                <span>${foodData.protein}</span>
                            </div>
                            <div class="nutrition-row">
                                <span>Carbohydrates</span>
                                <span>${foodData.carbs}</span>
                            </div>
                            <div class="nutrition-row">
                                <span>Total Fat</span>
                                <span style="color: ${parseInt(foodData.fat) > 15 ? '#dc2626' : '#334155'};">${foodData.fat} ${parseInt(foodData.fat) > 15 ? '‚ö†Ô∏è' : ''}</span>
                            </div>
                            <div class="nutrition-row">
                                <span>Dietary Fiber</span>
                                <span>${foodData.fiber}</span>
                            </div>
                        </div>
                        ${!isHealthy ? `
                            <div style="margin-top: 15px; padding: 15px; background: #fee2e2; border-radius: 8px; border-left: 3px solid #dc2626;">
                                <p style="color: #991b1b; font-size: 0.95em; font-weight: 600; margin-bottom: 8px;">
                                    üö´ Nutritional Concerns:
                                </p>
                                <ul style="color: #991b1b; font-size: 0.9em; padding-left: 20px; line-height: 1.6;">
                                    <li>High in empty calories</li>
                                    <li>Excessive unhealthy fats</li>
                                    <li>Low in vitamins & minerals</li>
                                    <li>Contains artificial additives</li>
                                </ul>
                            </div>
                        ` : `
                            <div style="margin-top: 15px; padding: 12px; background: #d1fae5; border-radius: 8px;">
                                <p style="color: #065f46; font-size: 0.9em; font-weight: 600;">
                                    ‚úì Rich in vitamins, minerals, antioxidants, and fiber. Excellent nutritional choice!
                                </p>
                            </div>
                        `}
                    </div>

                    <div class="result-card">
                        <h3><span class="icon">‚è∞</span> Shelf Life & Storage</h3>
                        <div class="shelf-life-timeline">
                            <div class="timeline-item">
                                <div class="timeline-dot" style="background: ${isHealthy ? '#14b8a6' : '#f59e0b'};"></div>
                                <div>
                                    <strong style="color: #0f172a;">Storage Duration:</strong><br>
                                    <span style="color: #64748b;">${foodData.shelfLife}</span>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-dot" style="background: #0f766e;"></div>
                                <div>
                                    <strong style="color: #0f172a;">Storage Method:</strong><br>
                                    <span style="color: #64748b;">${isHealthy ? 'Refrigerate in airtight container' : 'Store in cool, dry place'}</span>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <strong style="color: #0f172a;">${isHealthy ? 'Storage Tips:' : 'Health Recommendations:'}</strong>
                            <ul style="margin-top: 12px; padding-left: 20px; color: #64748b; line-height: 1.8;">
                                ${isHealthy ? `
                                    <li>Keep refrigerated at 2-4¬∞C</li>
                                    <li>Store in airtight container</li>
                                    <li>Consume within recommended time</li>
                                    <li>Check for signs of spoilage daily</li>
                                ` : `
                                    <li style="color: #dc2626;">‚ö†Ô∏è Limit consumption frequency</li>
                                    <li style="color: #dc2626;">‚ö†Ô∏è Not suitable for daily diet</li>
                                    <li>Consider healthier alternatives</li>
                                    <li>Balance with nutritious foods</li>
                                `}
                            </ul>
                        </div>
                    </div>
                </div>
            `;

            results.innerHTML = resultsHTML;
        }

        function resetApp() {
            uploadCard.style.display = 'block';
            previewSection.style.display = 'none';
            results.innerHTML = '';
            fileInput.value = '';
            currentImageData = null;
        }

        function toggleChat() {
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.classList.toggle('active');
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage(message, 'user');
                input.value = '';
                
                setTimeout(() => {
                    const response = getBotResponse(message);
                    addMessage(response, 'bot');
                }, 600);
            }
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function addMessage(text, sender) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            messageDiv.innerHTML = `<div class="message-bubble">${text}</div>`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function getBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('storage') || lowerMessage.includes('store')) {
                return 'For optimal storage: Keep vegetables in the crisper drawer at 2-4¬∞C, store fruits at room temperature until ripe, and place dairy products on middle shelves. Always use airtight containers! ü•¨';
            } else if (lowerMessage.includes('nutrition') || lowerMessage.includes('healthy')) {
                return 'A balanced diet includes: 5+ servings of fruits & vegetables daily, whole grains, lean proteins, healthy fats, and adequate hydration. Limit processed foods and added sugars! üåà';
            } else if (lowerMessage.includes('junk') || lowerMessage.includes('fast food')) {
                return 'Junk foods are high in calories, unhealthy fats, sugar, and sodium while low in nutrients. They can lead to weight gain and health issues. Try healthier alternatives like fruits, nuts, or homemade meals! üçé';
            } else if (lowerMessage.includes('recipe') || lowerMessage.includes('cook')) {
                return 'Try this healthy recipe: Mix fresh greens, cherry tomatoes, cucumbers, chickpeas, and feta. Dress with olive oil, lemon juice, salt, and pepper. Add grilled chicken for extra protein! ü•ó';
            } else if (lowerMessage.includes('shelf life') || lowerMessage.includes('last') || lowerMessage.includes('expire')) {
                return 'Typical shelf life: Leafy greens (3-5 days), root vegetables (1-2 weeks), most fruits (5-7 days), dairy (check date), cooked meals (3-4 days). Always refrigerate perishables! üìÖ';
            } else if (lowerMessage.includes('fresh') || lowerMessage.includes('spoiled')) {
                return 'Check freshness by: Visual inspection (color, mold), texture (firmness), smell (off odors), and expiration dates. When in doubt, throw it out! Safety first. üëÉ';
            } else {
                return 'I can help you with: food storage tips, nutrition advice, healthy recipes, shelf life information, and freshness checks. What would you like to know? üòä';
            }
        }

        // Initialize
        showPage('login');
    </script>
</body>
</html>